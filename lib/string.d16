strcpy: ;r0 = dest r1 = src
	ld.b r2,[r1]
	st.b [r0],r2
	test r2,r2
	jmp.eq 1f
	add r0,1
	add r1,1
	jmp strcpy
1:
	ret

strlen: ;ptr in r0
	xor r2,r2
1:
	ld.b r1,[r0]
	test r1,r1
	jmp.eq 2f
	add r0,1
	add r2,1
	jmp 1b
2:
	mov r0,r2
	ret

memcpy: ;r0 - dest, r1 - source, r3 count
	push r0
	xor r3,r3
	or r3,r0
	or r3,r1
	or r3,r2
	test r3,1
	jmp.eq memcpy_2
memcpy_loop:
	ld.b r3,[r1]
	st.b [r0],r3
	add r0,1
	add r1,1
	sub r2,1
	jmp.ne memcpy_loop
	pop r0
	ret
	
memcpy_2:
	ld r3,[r1]
	st [r0],r3
	add r0,2
	add r1,2
	sub r2,2
	jmp.ne memcpy_2
	pop r0
	ret

strcmp: ;str1 in r0, str1 in r1
	ld.b r2,[r0]
	ld.b r3,[r1]
	test r2,r2
	jmp.eq strcmp_end
	add r0,1
	add r1,1
	cmp r2,r3
	jmp.eq strcmp
	sub r2,r3
strcmp_end:
mov r0,r2
ret

strchr:
	and r1,0xff
strchr_loop:
	ld.b r2,[r0]
	test r2,r2
	jmp.eq strchr_end
	add r0,1
	cmp r2,r1
	jmp.ne strchr_loop
	sub r0,1
strchr_end:
	ret
memset: ; r0 - dest, r1 - val, r2 - nbytes
	push r0
memset_loop:
	st.b [r0],r1
	add r0,1
	sub r2,1
	jmp.ne memset_loop
	pop r0
	ret

memchr: ;ptr in r0, char in r1, count in r2
	ld.b r3,[r0]
	add r0,1
	sub r2,1
	jmp.eq memchr_end
	cmp r3,r1
	jmp.ne memchr
memchr_end:
	ret
memcmp: ;ptr1 in r0, ptr2 in r1, count in r2
	push r4	
memcmp_loop:
	ld.b r3,[r0]
	ld.b r4,[r1]
	sub r2,1
	jmp.n memcmp_end
	add r0,1
	add r1,1
	cmp r3,r4
	jmp.eq memcmp_loop
	sub r3,r4
	mov r0,r3
	pop r4
	ret
memcmp_end:
	mov r0,0
	pop r4
	ret

strcat: ;str1 in r0, str2 in r1
	push r0
strcat_start:
	ld.b r2,[r0]
	add r0,1
	test r2,r2
	jmp.ne strcat_start
	sub r0,1
strcat_loop:
	ld.b r2,[r1]
	st.b [r0],r2
	add r0,1
	add r1,1
	test r2,r2
	jmp.ne strcat_loop
	pop r0
	ret
